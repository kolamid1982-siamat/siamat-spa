<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SiAMAT - SPA Version</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="font-['Inter'] bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-200"
      x-data="app"
      x-init="init"
      @popstate.window="handlePopState"
      x-cloak>
    
    <!-- Loading Overlay -->
    <div x-show="loading" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center" style="display: none;">
        <div class="bg-white dark:bg-slate-800 rounded-2xl p-8 shadow-2xl flex flex-col items-center">
            <div class="w-16 h-16 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin"></div>
            <p class="mt-4 text-lg font-medium" x-text="loadingMessage"></p>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div x-show="toast.show" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 transform scale-90"
         x-transition:enter-end="opacity-100 transform scale-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 transform scale-100"
         x-transition:leave-end="opacity-0 transform scale-90"
         class="fixed top-4 right-4 z-50 max-w-md"
         style="display: none;">
        <div :class="{
            'bg-green-500': toast.type === 'success',
            'bg-red-500': toast.type === 'error',
            'bg-blue-500': toast.type === 'info',
            'bg-yellow-500': toast.type === 'warning'
        }" class="rounded-xl shadow-2xl p-4 text-white">
            <div class="flex items-center">
                <i :class="{
                    'fa-solid fa-check-circle': toast.type === 'success',
                    'fa-solid fa-exclamation-circle': toast.type === 'error',
                    'fa-solid fa-info-circle': toast.type === 'info',
                    'fa-solid fa-exclamation-triangle': toast.type === 'warning'
                }" class="text-xl mr-3"></i>
                <div>
                    <p class="font-semibold" x-text="toast.title"></p>
                    <p class="text-sm opacity-90" x-text="toast.message"></p>
                </div>
                <button @click="toast.show = false" class="ml-4 text-white/80 hover:text-white">
                    <i class="fa-solid fa-times"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Login Page -->
    <div x-show="!isAuthenticated" class="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500">
        <div class="w-full max-w-md">
            <div class="bg-white/90 dark:bg-slate-800/90 backdrop-blur-xl rounded-3xl shadow-2xl p-8 border border-white/20">
                <div class="text-center mb-8">
                    <h1 class="text-4xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">SiAMAT</h1>
                    <p class="text-sm text-slate-600 dark:text-slate-400 mt-2">Sistem Administrasi Matematika Terpadu</p>
                    <p class="text-xs text-slate-500 dark:text-slate-500 mt-1">Versi Single Page Application</p>
                </div>
                
                <form @submit.prevent="handleLogin" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">Username</label>
                        <input type="text" x-model="loginForm.username" required
                               class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 focus:ring-2 focus:ring-indigo-500 transition">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Password</label>
                        <input type="password" x-model="loginForm.password" required
                               class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 focus:ring-2 focus:ring-indigo-500 transition">
                    </div>
                    
                    <button type="submit" 
                            class="w-full py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-semibold hover:from-indigo-700 hover:to-purple-700 transform hover:scale-[1.02] transition-all duration-200 shadow-lg">
                        Masuk
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Main App SPA -->
    <div x-show="isAuthenticated" class="flex h-screen overflow-hidden">
        
        <!-- Sidebar -->
        <div :class="{'w-72': !sidebarCollapsed, 'w-20': sidebarCollapsed}" 
             class="bg-white/70 dark:bg-slate-800/70 backdrop-blur-xl border-r border-white/20 dark:border-slate-700/50 transition-all duration-300 flex flex-col shadow-2xl">
            
            <!-- Logo -->
            <div class="p-6 flex items-center justify-between border-b border-slate-200/50 dark:border-slate-700/50">
                <div x-show="!sidebarCollapsed" class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl"></div>
                    <span class="font-bold text-xl">SiAMAT</span>
                </div>
                <div x-show="sidebarCollapsed" class="w-full flex justify-center">
                    <div class="w-8 h-8 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl"></div>
                </div>
                <button @click="toggleSidebar" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-xl transition">
                    <i :class="sidebarCollapsed ? 'fa-solid fa-chevron-right' : 'fa-solid fa-chevron-left'" class="text-slate-500"></i>
                </button>
            </div>
            
            <!-- User Info -->
            <div class="p-4 border-b border-slate-200/50 dark:border-slate-700/50">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-xl flex items-center justify-center text-white font-bold">
                        {{ user.nama ? user.nama.charAt(0).toUpperCase() : 'U' }}
                    </div>
                    <div x-show="!sidebarCollapsed">
                        <p class="font-semibold" x-text="user.nama || 'User'"></p>
                        <p class="text-xs text-slate-500 dark:text-slate-400" x-text="user.role || 'TAMU'"></p>
                    </div>
                </div>
            </div>
            
            <!-- Navigation SPA -->
            <nav class="flex-1 overflow-y-auto p-4 space-y-2">
                <template x-for="item in menuItems" :key="item.id">
                    <a href="#" @click.prevent="navigate(item.id, item.name)"
                       :class="{
                           'bg-gradient-to-r from-indigo-600 to-purple-600 text-white': currentPage === item.id,
                           'hover:bg-slate-100 dark:hover:bg-slate-700': currentPage !== item.id
                       }"
                       class="flex items-center space-x-3 px-4 py-3 rounded-xl transition-all duration-200">
                        <i :class="item.icon" class="w-5 text-center"></i>
                        <span x-show="!sidebarCollapsed" x-text="item.name"></span>
                    </a>
                </template>
            </nav>
            
            <!-- Bottom Actions -->
            <div class="p-4 border-t border-slate-200/50 dark:border-slate-700/50 space-y-2">
                <button @click="toggleDarkMode" class="flex items-center space-x-3 px-4 py-3 w-full hover:bg-slate-100 dark:hover:bg-slate-700 rounded-xl transition">
                    <i :class="darkMode ? 'fa-solid fa-sun' : 'fa-solid fa-moon'" class="w-5 text-center"></i>
                    <span x-show="!sidebarCollapsed" x-text="darkMode ? 'Light Mode' : 'Dark Mode'"></span>
                </button>
                <button @click="logout" class="flex items-center space-x-3 px-4 py-3 w-full hover:bg-red-50 dark:hover:bg-red-900/20 text-red-600 rounded-xl transition">
                    <i class="fa-solid fa-sign-out-alt w-5 text-center"></i>
                    <span x-show="!sidebarCollapsed">Keluar</span>
                </button>
            </div>
        </div>
        
        <!-- Main Content SPA -->
        <div class="flex-1 flex flex-col overflow-hidden">
            
            <!-- Header -->
            <header class="bg-white/70 dark:bg-slate-800/70 backdrop-blur-xl border-b border-white/20 dark:border-slate-700/50 px-6 py-4">
                <div class="flex items-center justify-between">
                    <h1 class="text-2xl font-bold" x-text="pageTitle"></h1>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-slate-500" x-text="currentDate"></span>
                    </div>
                </div>
            </header>
            
            <!-- Page Content - Dinamis SPA -->
            <main class="flex-1 overflow-y-auto p-6">
                <!-- Konten akan diisi oleh router -->
                <div x-html="currentContent"></div>
            </main>
        </div>
    </div>
    
    <!-- Scripts SPA -->
    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/store.js"></script>
    <script src="js/router.js"></script>
    
    <!-- Components -->
    <script src="js/components/dashboard.js"></script>
    <script src="js/components/kelas.js"></script>
    <script src="js/components/siswa.js"></script>
    <script src="js/components/perencanaan.js"></script>
    <script src="js/components/absensi.js"></script>
    <script src="js/components/jurnal.js"></script>
    <script src="js/components/nilai.js"></script>
    <script src="js/components/users.js"></script>
    
    <!-- Main App -->
    <script src="js/app.js"></script>
    <!-- 4. Test script -->
    <script>
        // Test apakah component terdaftar
        console.log('âœ… Components loaded:', {
            Dashboard: typeof DashboardComponent !== 'undefined',
            Kelas: typeof KelasComponent !== 'undefined',
            Router: typeof Router !== 'undefined',
            Store: typeof Store !== 'undefined'
        });
    </script>
</body>
</html>
